<ng-container *ngIf="form">
    <form [formGroup]="form" [ngClass]="{'field-form': isField}">
        <button mat-icon-button (click)="onCloseField()" *ngIf="isField">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <mat-form-field appearance="outline" *ngIf="!isField">
            <mat-label>Query name</mat-label>
            <mat-select formControlName="name">
                <mat-option *ngFor="let type of availableQueries | async" [value]="type.name">
                    {{type.name}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" *ngIf="isField">
            <mat-label>Field name</mat-label>
            <input matInput formControlName="name" type="text"/>
        </mat-form-field>
        <button class="form-error" mat-icon-button *ngIf="form.invalid">
            <mat-icon>error</mat-icon>
        </button>
        <mat-tab-group mat-align-tabs="start" animationDuration="0ms" *ngIf="form.getRawValue().name">
            <mat-tab label="Fields">
                <ng-template matTabContent>
                    <who-tab-fields [form]="form.controls.fields" [fields]="availableFields" [factory]="factory"></who-tab-fields>
                </ng-template>
            </mat-tab>
            <mat-tab label="Sort" *ngIf="form.get('sort')">
                <ng-template matTabContent>
                    <who-tab-sort [form]="form.controls.sort" [fields]="availableScalarFields"></who-tab-sort>
                </ng-template>
            </mat-tab>
            <mat-tab label="Filter" *ngIf="form.get('filter')">
                <ng-template matTabContent>
                    <who-tab-filter [form]="form.controls.filter" [filters]="availableFilters"></who-tab-filter>
                </ng-template>
            </mat-tab>
        </mat-tab-group>
    </form>
</ng-container>